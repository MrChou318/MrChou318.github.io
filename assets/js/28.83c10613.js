(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{535:function(n,s,e){"use strict";e.r(s);var a=e(3),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"代码分离"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码分离"}},[n._v("#")]),n._v(" 代码分离")]),n._v(" "),e("p",[n._v("代码分离是 webpack 中最引人注目的特性之一。此特性能够把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。\n代码分离可以用于获取更小的 bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间。")]),n._v(" "),e("p",[n._v("常用的代码分离方法有三种：")]),n._v(" "),e("ul",[e("li",[e("strong",[n._v("入口起点")]),n._v("：使用 "),e("code",[n._v("entry")]),n._v(" 配置手动地分离代码。")]),n._v(" "),e("li",[e("strong",[n._v("防止重复")]),n._v("：使用 Entry dependencies 或者 SplitChunksPlugin 去重和分离 chunk。")]),n._v(" "),e("li",[e("strong",[n._v("动态导入")]),n._v("：通过模块的内联函数调用来分离代码。")])]),n._v(" "),e("h2",{attrs:{id:"入口起点-entry-point"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入口起点-entry-point"}},[n._v("#")]),n._v(" 入口起点(entry point)")]),n._v(" "),e("p",[n._v("这是迄今为止最简单的分离代码的方式。不过，这种方式手动配置较多，并有一些隐患。先来看看如何从main bundle 中分离 another module（另一个模块）：")]),n._v(" "),e("p",[n._v("我们先调整目录结构\n"),e("strong",[n._v("project")]),n._v("\nwebpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n|- index.js")]),n._v(" "),e("ul",[e("li",[n._v("|- another-module.js\n|- /node_modules")])]),n._v(" "),e("p",[n._v("我们添加 "),e("code",[n._v("lodash")]),n._v(" 依赖做范例：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("npm install --save lodash\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[e("strong",[n._v("src/index.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("+ import _ from 'lodash';\n- import printMe from './print.js'\n\nfunction component() {\n  const element = document.createElement('div');\n- element.innerHTML = ['Hello', 'webpack'].join('===');\n+ element.innerHTML = _.join(['Hello', 'webpack'], '===');\n  element.classList.add('hello');\n\n- const button = document.createElement('button')\n- button.innerHTML = '点我点我';\n- button.onclick = printMe;\n- element.appendChild(button)\n\n  return element;\n}\ndocument.body.appendChild(component());\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br")])]),e("p",[e("strong",[n._v("another-module.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("import _ from 'lodash';\n\nconsole.log(_.join(['Another', 'module', 'loaded!'], '&&&'))\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br")])]),e("p",[e("strong",[n._v("webpack.config.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("   const path = require('path');\n-  const HtmlWebpackPlugin = require('html-webpack-plugin');\n-  const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nmodule.exports = {\n  mode: 'development',\n  entry: {\n    index: './src/index.js',\n+   another: './src/another-module.js',\n  },\n- devtool: 'inline-source-map',\n- devServer: {\n-   contentBase: './dist',\n- },\n- plugins: [\n-     new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),\n-     new HtmlWebpackPlugin({\n-       title: '开发环境',\n-     })\n- ],\n  output: {\n    filename: '[name].bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n-   publicPath: '/',\n  },\n};\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br")])]),e("p",[n._v("执行 "),e("code",[n._v("npm run build")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("$ npm run build\n\nasset index.bundle.js 554 KiB [compared for emit] (name: index)\nasset another.bundle.js 554 KiB [emitted] (name: another)\nruntime modules 2.5 KiB 12 modules\ncacheable modules 532 KiB\n  ./src/index.js 261 bytes [built] [code generated]\n  ./src/another-module.js 89 bytes [built] [code generated]\n  ./node_modules/lodash/lodash.js 531 KiB [built] [code generated]\nwebpack 5.23.0 compiled successfully in 240 ms\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br")])]),e("p",[n._v("正如前面提到的，这种方式存在一些隐患：")]),n._v(" "),e("ul",[e("li",[n._v("如果入口 chunk 之间包含一些重复的模块，那些重复模块都会被引入到各个 bundle 中。")]),n._v(" "),e("li",[n._v("这种方法不够灵活，并且不能动态地将核心应用程序逻辑中的代码拆分出来。\n以上两点中，第一点对我们的示例来说无疑是个问题，因为之前我们在 "),e("code",[n._v("./src/index.js")]),n._v(" 中也引入过 "),e("code",[n._v("lodash")]),n._v("，这样就在两个 bundle 中造成重复引用。")])]),n._v(" "),e("h2",{attrs:{id:"防止重复-prevent-duplication"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#防止重复-prevent-duplication"}},[n._v("#")]),n._v(" 防止重复(prevent duplication)")]),n._v(" "),e("h3",{attrs:{id:"入口依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入口依赖"}},[n._v("#")]),n._v(" 入口依赖")]),n._v(" "),e("p",[n._v("配置 "),e("code",[n._v("dependOn option")]),n._v(" 选项，这样可以在多个 chunk 之间共享模块：\n"),e("strong",[n._v("webpack.config.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v(" const path = require('path');\n\n module.exports = {\n   mode: 'development',\n   entry: {\n-    index: './src/index.js',\n-    another: './src/another-module.js',\n+    index: {\n+      import: './src/index.js',\n+      dependOn: 'shared',\n+    },\n+    another: {\n+      import: './src/another-module.js',\n+      dependOn: 'shared',\n+    },\n+    shared: 'lodash',\n   },\n   output: {\n     filename: '[name].bundle.js',\n     path: path.resolve(__dirname, 'dist'),\n   },\n };\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br")])]),e("p",[n._v("如果我们要在一个 HTML 页面上使用多个入口时，还需设置 optimization.runtimeChunk: 'single'，否则还会遇到这里所述的麻烦。\n"),e("strong",[n._v("webpack.config.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v(" const path = require('path');\n\n module.exports = {\n   mode: 'development',\n   entry: {\n     index: {\n       import: './src/index.js',\n       dependOn: 'shared',\n     },\n     another: {\n       import: './src/another-module.js',\n       dependOn: 'shared',\n     },\n     shared: 'lodash',\n   },\n   output: {\n     filename: '[name].bundle.js',\n     path: path.resolve(__dirname, 'dist'),\n   },\n+  optimization: {\n+    runtimeChunk: 'single',\n+  },\n };\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br")])]),e("p",[n._v("构建结果如下：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("$ npm run build\n\nasset shared.bundle.js 550 KiB [emitted] (name: shared)\nasset runtime.bundle.js 7.91 KiB [emitted] (name: runtime)\nasset index.bundle.js 1.57 KiB [emitted] (name: index)\nasset another.bundle.js 1.45 KiB [emitted] (name: another)\nEntrypoint index 1.57 KiB = index.bundle.js\nEntrypoint another 1.45 KiB = another.bundle.js\nEntrypoint shared 558 KiB = runtime.bundle.js 7.91 KiB shared.bundle.js 550 KiB\nruntime modules 3.76 KiB 7 modules\ncacheable modules 532 KiB\n  ./node_modules/lodash/lodash.js 531 KiB [built] [code generated]\n  ./src/another-module.js 89 bytes [built] [code generated]\n  ./src/index.js 261 bytes [built] [code generated]\nwebpack 5.23.0 compiled successfully in 244 ms\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br")])]),e("p",[n._v("由上可知，除了生成 shared.bundle.js，index.bundle.js 和 another.bundle.js 之外，还生成了一个 runtime.bundle.js 文件。")]),n._v(" "),e("h3",{attrs:{id:"splitchunksplugin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#splitchunksplugin"}},[n._v("#")]),n._v(" splitChunksPlugin")]),n._v(" "),e("p",[e("code",[n._v("SplitChunksPlugin")]),n._v(" 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。\n让我们使用这个插件，将之前的示例中重复的 lodash 模块去除：\n"),e("strong",[n._v("webpack.config.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("  const path = require('path');\n\n  module.exports = {\n    mode: 'development',\n    entry: {\n      index: './src/index.js',\n      another: './src/another-module.js',\n    },\n    output: {\n      filename: '[name].bundle.js',\n      path: path.resolve(__dirname, 'dist'),\n    },\n+   optimization: {\n+     splitChunks: {\n+       chunks: 'all',\n+     },\n+   },\n  };\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("p",[n._v("使用 "),e("code",[n._v("optimization.splitChunks")]),n._v(" 配置选项后，"),e("code",[n._v("index.bundle.js")]),n._v(" 和 "),e("code",[n._v("another.bundle.js")]),n._v("中已经移除了重复的依赖模块。\n需要注意的是，插件将 "),e("code",[n._v("lodash")]),n._v(" 分离到单独的 "),e("code",[n._v("chunk")]),n._v("，并且将其从 main bundle 中移除，减轻了大小。执行 npm run build 查看效果：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("$ npm run build\n\nasset vendors-node_modules_lodash_lodash_js.bundle.js 550 KiB [emitted] (id hint: vendors)\nasset index.bundle.js 8.85 KiB [emitted] (name: index)\nasset another.bundle.js 8.73 KiB [emitted] (name: another)\nEntrypoint index 559 KiB = vendors-node_modules_lodash_lodash_js.bundle.js 550 KiB index.bundle.js 8.85 KiB\nEntrypoint another 559 KiB = vendors-node_modules_lodash_lodash_js.bundle.js 550 KiB another.bundle.js 8.73 KiB\nruntime modules 7.64 KiB 14 modules\ncacheable modules 532 KiB\n  ./src/index.js 261 bytes [built] [code generated]\n  ./src/another-module.js 89 bytes [built] [code generated]\n  ./node_modules/lodash/lodash.js 531 KiB [built] [code generated]\nwebpack 5.23.0 compiled successfully in 245 ms\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br")])]),e("h2",{attrs:{id:"动态导入-dynamic-import"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态导入-dynamic-import"}},[n._v("#")]),n._v(" 动态导入（dynamic import）")]),n._v(" "),e("p",[n._v("在开始前，我们先调整目录结构\n"),e("strong",[n._v("project")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n  |- index.js\n- |- another-module.js\n|- /node_modules\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br")])]),e("p",[e("strong",[n._v("webpack.config.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v(" const path = require('path');\n\n module.exports = {\n   mode: 'development',\n   entry: {\n     index: './src/index.js',\n-    another: './src/another-module.js',\n   },\n   output: {\n     filename: '[name].bundle.js',\n     path: path.resolve(__dirname, 'dist'),\n   },\n-  optimization: {\n-    splitChunks: {\n-      chunks: 'all',\n-    },\n-  },\n };\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("p",[e("strong",[n._v("src/index.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("- import _ from 'lodash';\n- \n- function component() {\n-   const element = document.createElement('div');\n-   element.innerHTML = _.join(['Hello', 'webpack'], '===');\n-   element.classList.add('hello');\n- \n-   return element;\n- }\n- document.body.appendChild(component());\n\n+ function getComponent() {\n+   return import('lodash')\n+       .then(({ default: _ }) => {\n+         const element = document.createElement('div')\n+         element.innerHTML = _.join(['Hello', 'webpack'], '===');\n+         return element;\n+       })\n+       .catch((error) => 'An error occurred while loading the component')\n+ }\n+ \n+ getComponent().then((component) => {\n+   document.body.appendChild(component);\n+ })\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br")])]),e("p",[n._v("简化代码：由于import() 会返回一份promise，因此它可以和async函数一起使用。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("- function getComponent() {\n-   return import('lodash')\n-       .then(({ default: _ }) => {\n-         const element = document.createElement('div')\n-         element.innerHTML = _.join(['Hello', 'webpack'], '===');\n-         return element;\n-       })\n-       .catch((error) => 'An error occurred while loading the component')\n- }\n+ async function getComponent() {\n+   const element = document.createElement('div')\n+   const { default: _ } = await import('lodash');\n+   element.innerHTML = _.join(['Hello', 'webpack'], '===');\n+   return element;\n+ }\n\ngetComponent().then((component) => {\n  document.body.appendChild(component);\n})\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br")])]),e("h2",{attrs:{id:"预获取-预加载模块-prefetch-preload-module"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#预获取-预加载模块-prefetch-preload-module"}},[n._v("#")]),n._v(" 预获取/预加载模块（prefetch/preload module）")]),n._v(" "),e("p",[n._v("webpack v4.6.0+ 增加了对预获取和预加载的支持。")]),n._v(" "),e("p",[n._v("在声明import时，使用下面这些内置命令，可以让webpack输出'resource hint(资源提示)'，来告知浏览器：")]),n._v(" "),e("ul",[e("li",[n._v("prefetch(预获取)：将来某些导航下可能需要的资源")]),n._v(" "),e("li",[n._v("preload(预加载)：当前导航下可能需要的资源")])]),n._v(" "),e("p",[n._v("下面这个 prefetch 的简单示例中，有一个 "),e("code",[n._v("index")]),n._v(" 组件，\n其内部渲染一个 "),e("code",[n._v("btn")]),n._v(" 组件，然后在点击后按需加载 "),e("code",[n._v("prefetchTest")]),n._v(" 组件。\n"),e("strong",[n._v("src/index.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("import _ from 'lodash';\nimport clickMe from './btn'\n\nfunction component() {\n    const element = document.createElement('div');\n    element.innerHTML = _.join(['Hello', 'webpack'], '===');\n\n    const btn = document.createElement('button');\n    btn.innerHTML = '点我点我';\n    btn.onclick = clickMe;\n    element.appendChild(btn);\n\n    return element;\n  }\ndocument.body.appendChild(component());\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br")])]),e("p",[e("strong",[n._v("src/btn.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("export default function ClickMe() {\n  console.log('点我作甚？')\n  import(/* webpackPrefetch: true */ './prefetchTest')\n      .then(({ default: _ }) => {\n        console.log('引入成功..')\n      })\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br")])]),e("p",[e("strong",[n._v("src/prefetchTest.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("console.log('prefetchTest')\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[e("strong",[n._v("webpack.config.js")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("const path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nconst { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nmodule.exports = {\n  mode: 'development',\n  entry: {\n    index: './src/index.js',\n  },\n  plugins: [\n    new CleanWebpackPlugin(),\n    new HtmlWebpackPlugin({\n      title: 'prefetch',\n    }),\n  ],\n  output: {\n    filename: '[name].bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n};\n\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br")])]),e("p",[n._v("重新编译代码 "),e("code",[n._v("npm run build")]),n._v("，通过以下两个方式可以判断是否预获取成功：")]),n._v(" "),e("ol",[e("li",[n._v("在浏览器中打开index.html，f12--Elements--在head标签里面可以看到有"),e("code",[n._v("link")]),n._v("标签，"),e("code",[n._v("rel")]),n._v("属性为"),e("code",[n._v("prefetch")]),n._v("；")]),n._v(" "),e("li",[n._v("f12--network，刷新页面也可以看到页面初始化就加载了"),e("code",[n._v("src_prefetchTest_js.bundle.js")]),n._v("，而不是点击按钮才加载"),e("code",[n._v("refetchTest.js")]),n._v("文件。\n你可以试试去掉 "),e("code",[n._v("src/btn.js")]),n._v(" 里面的 "),e("code",[n._v("/* webpackPrefetch: true */")]),n._v(" 代码，重新编译。")])]),n._v(" "),e("p",[n._v("预加载：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("import(/* webpackPrefetch: true */ './xxx.js');\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("ul",[e("li",[n._v("preload chunk 会在父 chunk 加载时，以并行方式开始加载。prefetch chunk 会在父 chunk 加载结束后开始加载。")]),n._v(" "),e("li",[n._v("preload chunk 具有中等优先级，并立即下载。prefetch chunk 在浏览器闲置时下载。")]),n._v(" "),e("li",[n._v("preload chunk 会在父 chunk 中立即请求，用于当下时刻。prefetch chunk 会用于未来的某个时刻。")])])])}),[],!1,null,null,null);s.default=t.exports}}]);
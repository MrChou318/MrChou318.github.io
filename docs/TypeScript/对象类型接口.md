---
title: 对象类型接口
date: 2021-04-26 10:59:00 PM
categories:
    - TypeScript
tags:
    - TypeScript
---
假设我们从后端获取数据，渲染到页面之中
```ts
interface List {
    id: number;
    name: string;
}
interface Result {
    data: List[]
}
function render(result: Result) {
    result.data.forEach((value => {
        console.log(value.id, value.name)
    }))
}
let result = {
    data: [
        {id: 1, name: 'A'},
        {id: 2, name: 'B'}
    ]
}
render(result)
```
但实际情况后端往往会传回来预定之外的字段，例如
```ts
let result = {
    data: [
        {id: 1, name: 'A', sex: 'male'},
        {id: 2, name: 'B'}
    ]
}
```
这种情况是允许的，一只鸟如果看起来像鸭子，游起来像鸭子，叫起来像鸭子，那么这只鸟就可以被认为是鸭子；  
对于ts，只要传入的对象，满足接口的必要条件，那么就是被允许的，即使传入多余的字段，也可以绕过类型检查。  
但如果我们直接传入对象自变量的话，ts就会对额外的字段进行类型检查：
```ts
render({
    data: [
        {id: 1, name: 'A', sex: 'male'},
        {id: 2, name: 'B'}
    ]
})
```
绕过这种检查的方法有三种
1. 像刚才那样，把对象自变量赋值给一个变量；
2. 使用类型断言: `as Result`，含义就是明确告诉编译器我们知道这个对象的类型就是Result
```ts
render({
    data: [
        {id: 1, name: 'A', sex: 'male'},
        {id: 2, name: 'B'}
    ]
} as Result)
```
3. 使用字符串索引签名
```ts
interface List {
    id: number;
    name: string;
    [x: string]: any;
}
```
含义：用任意的字符串去索引list，可以得到任意的结果，这样list就可以支持多个属性了

## 可选属性
```ts
interface List {
    id: number;
    name: string;
    age?: number;
}
```
在属性的后面添加问号，表示这个属性可以有，也可以没有
```ts
interface List {
    id: number;
    name: string;
    age?: number;
}
interface Result {
    data: List[]
}
function render(result: Result) {
    result.data.forEach((value => {
        console.log(value.id, value.name)
        if (value.age) {
            console.log(value.age)
        }
    }))
}
let result = {
    data: [
        {id: 1, name: 'A'},
        {id: 2, name: 'B', age: 11}
    ]
}
render(result)
```

## 只读属性
```ts
interface List {
    readonly id: number;
    name: string;
    age?: number;
}
```
只读属性是不允许被修改的

以上接口属性的个数都是固定的，当你不确定一个接口中有多少个属性的时候，就可以是会用可索引类型的接口，可以用数字或者字符串索引；  
## 索引签名包含了字符串索引签名和数字索引签名
数字索引  
```ts
interface StringArray {
    [index: number]: string // 用任意的数字去索引StringArray，都会得到一个string，相当于声明了一个字符串类型的数组
}
let chars: StringArray = ['A', 'B']
```
```ts
interface Names {
    [x: string]: string // 用任意的字符串去索引Names，都会得到一个string
    // y: number   // 上面这样声明后，就不能number类型的成员了
    // 另外两种索引签名是可以混用的
    [z: number]: string // 也就是说我们既可以用字符串来索引Names，也可以用数字去索引Names，
    // 这里需要注意的是，数字索引签名的返回值一定要是字符串索引签名返回值的子类型，这是javascript会进行类型转换，将number转换为string，这样就能保持类型的兼容性
}

```
